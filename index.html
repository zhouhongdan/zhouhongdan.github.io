<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/>
  <meta content="yes" name="apple-mobile-web-app-capable" />
  <meta content="telephone=no" name="format-detection" />
  <meta content="email=no" name="format-detection" />
  <meta content="black" name="apple-mobile-web-app-status-bar-style" />
  <meta name="msapplication-tap-highlight" content="no" />
  <meta name="description" content="短线高手，免费领牛股" />
  <meta name="keywords" content="短线高手，免费领牛股" />
  <script src="js/phone.js"></script>
	<title>短线高手，免费领牛股</title>
	<link rel="stylesheet" href="css/reset.css">
	<link rel="stylesheet" href="css/index.css">
</head>
<body>
<input name="_csrf" type="hidden" id="_csrf" value="<?= Yii::$app->request->csrfToken ?>">
<div class="main">
		<!-- banner -->
		<div class="banner">
				<div class="banner1">
						<img src="images/b_ling.png" alt="" class="banner1_ling animate_s_b">
				</div>
				<div class="banner2">
						<div class="banner2_title"></div>
						<div class="banner2_words">
								<div class="inner_banner2_words">
										<span>已有</span>
										<span class="banner2_num">688</span>
										<span>名客户成功领取</span>
								</div>
						</div>
				</div>
		</div>
		<!-- main_input -->
		<div class="main_input">
				<div class="inner_main_input_box">
						<div class="main_input_tel">
								<input type="text" name="input_tel_num" class="input_telNum tel1" placeholder="输入手机号">
						</div>
						<div class="main_input_code">
								<div class="inner_code_box">
										<input type="text" name="input_code_num" class="input_codeNum set_code1" placeholder="输入验证码">
								</div>
								<span class="input_codeBtn code_btn1">获取验证码</span>
						</div>
						<div class="main_input_EBtn animate_s_b submit_ajax1">立即领取</div>
				</div>
		</div>
		<!-- main_tequan -->
		<div class="main_tequan">
				<img src="images/t1.png" alt="" class="main_tequan_t">
				<img src="images/tequan_img.png" alt="" class="main_tequan_img">
		</div>
		<!-- main_chat -->
		<div class="main_chat">
				<img src="images/t2.png" alt="" class="main_chat_t">
				<img src="images/chat.png" alt="" class="main_chat_img">
		</div>
		<div class="main_foot_input">
				<div class="main_foot_input_title"><span>四</span></div>
				<div class="main_foot_input_box">
						<div class="inner_main_input_box">
								<div class="main_input_tel">
										<input type="text" name="input_tel_num" class="input_telNum tel2" placeholder="输入手机号">
								</div>
								<div class="main_input_code">
										<div class="inner_code_box">
												<input type="text" name="input_code_num" class="input_codeNum set_code2" placeholder="输入验证码">
										</div>
										<span class="input_codeBtn code_btn2">获取验证码</span>
								</div>
						</div>
				</div>
				<div class="main_foot_EBtn animate_s_b submit_ajax2"></div>
		</div>
		<div class="foot">
				<p>投资有风险，入市需谨慎</p>
				<p>从事证券投资或期货交易，请通过合法证券期货经营机构进行。</p>
		</div>
		<div class="mask"></div>
		<div class="pop_succus">
				<span class="pop_succus_close"></span>
		</div>
</div>

<script src="js/jquery-1.11.2.min.js"></script>
<script>
	$(function(){

			$('.pop_succus_close').click(function(){
					$(this).parent('.pop_succus').hide();
					$('.mask').hide();
			})

			//随机号生产
			var init_num = 688;
			var timer_random = null;
			timer_random = setInterval(function(){
				init_num += parseInt(Math.random()*3);
				$('.banner2_num').html(init_num)
				// console.log(init_num)
			},2500)


			var csrfToken = $('#_csrf').attr("value");
			new code_fn('tel1','code_btn1','submit_ajax1','set_code1');
			new code_fn('tel2','code_btn2','submit_ajax2','set_code2');

			function code_fn(obj_tel_ele,obj_code_btn_ele,obj_submit_btn,obj_code_ele){
				this.obj_tel = obj_tel_ele;
				this.obj_code_btn = obj_code_btn_ele;
				this.obj_submit_btn = obj_submit_btn;
				this.code_ele = obj_code_ele ;
				var ok = false;
				var timer = null;

				var _this = this;
				//倒计时
				$('.'+this.obj_code_btn).click(function(){
					ok = _this.tel_yanzheng();
					var num = 60;
					if(ok){
							clearInterval(timer)
							timer = setInterval(function(){
								num--;
								if(num <= -1){
										num = '请重新发送';
										clearInterval(timer);
								}
								$('.'+_this.obj_code_btn).html(num);
							},1000);
							$.ajax({
								url : '/promotion/send',
								type : 'post',
								dataType:'json',
								data : {
									'_csrf-frontend':csrfToken,
									'mobile' : ok
								},
								success:function(msg){
									 if(msg.code == '2001'){
										alert("发送成功");
									 }else{
										alert(msg.message);
									 }
								}
							});
					}else{
						 return;
					}
				});

				//提交 验证码
				$('.'+this.obj_submit_btn).click(function(){
					var get_code = $('.'+_this.code_ele).val();
					var get_tel = $('.'+_this.obj_tel).val();
					var key_keyword = getQueryString('keyword');
					var key_source = getQueryString('source');
					// console.log(key_keyword,key_source)
					if(get_code == ''){
						alert('短信验证不能为空');
						return false;
					}else if( get_tel && get_code){
						$.ajax({
							url : '/promotion/create',
							type : 'post',
							dataType:'json',
							data : {
								'_csrf-frontend':csrfToken,
								'mobile' : get_tel,
								'code' : get_code,
								'keyword': key_keyword,
								'source':key_source
							},
							success:function(data){
								if(data.code == '200'){
									$('.pop_succus').show();
									$('.mask').show();
								}else{
								   alert(data.message);
								}
							}
						});
					}
				});
			}
			code_fn.prototype.tel_yanzheng = function(){
				var get_tel = $('.'+this.obj_tel).val();
				var tel_zz = /^[1][3,4,5,7,8][0-9]{9}$/;
				if(get_tel == ''){
					alert('手机号码不能为空');
					return false;
				}else if(!tel_zz.test(get_tel)){
					alert('请输入正确的手机号');
					$('.'+this.obj_tel).val('');
					return false;
				}else{
					return get_tel;
				}
			};

	})
	function getQueryString(key){
      var reg = new RegExp("(^|&)"+key+"=([^&]*)(&|$)");
      var result = window.location.search.substr(1).match(reg);
      return result?decodeURIComponent(result[2]):'none';
	}
</script>

</body>
</html>